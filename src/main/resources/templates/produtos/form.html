<!DOCTYPE html>
<html lang="pt-BR" th:replace="~{layout/base :: layout(
    pageTitle=${modoEdicao ? 'Editar Produto' : 'Novo Produto'},
    activePage='produtos',
    content=~{::main},
    extraHead=~{},
    extraScript=~{::script}
)}">
<main>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="/web/estoque/produtos">Produtos Acabados</a></li>
            <li class="breadcrumb-item active" th:text="${modoEdicao ? 'Editar' : 'Novo Produto'}">Novo Produto</li>
        </ol>
    </nav>

    <form th:action="@{/web/estoque/produtos/salvar}" method="post" th:object="${produto}">
        <input type="hidden" th:field="*{id}">

        <div class="row g-3">
            <!-- COLUNA PRINCIPAL -->
            <div class="col-md-8">
                <!-- IDENTIFICAÇÃO -->
                <div class="card mb-3">
                    <div class="card-header"><span style="font-weight:600;font-size:.9rem"><i class="fas fa-tag me-2 text-primary"></i>Identificação</span></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Nome do Produto <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" th:field="*{nome}" placeholder="Ex: Shampoo Hidratante 500ml" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">SKU</label>
                                <input type="text" class="form-control" th:field="*{sku}" placeholder="SH-HID-500">
                                <small class="text-muted">Código interno do produto</small>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">EAN (Código de Barras)</label>
                                <input type="text" class="form-control" th:field="*{ean}" placeholder="7891234567890" maxlength="13">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Unidade</label>
                                <select class="form-select" th:field="*{unidade}">
                                    <option value="">Selecione</option>
                                    <option value="UN">UN — Unidade</option>
                                    <option value="KG">KG — Quilograma</option>
                                    <option value="L">L — Litro</option>
                                    <option value="ML">ML — Mililitro</option>
                                    <option value="G">G — Grama</option>
                                    <option value="CX">CX — Caixa</option>
                                    <option value="PCT">PCT — Pacote</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Descrição</label>
                                <textarea class="form-control" th:field="*{descricao}" rows="2" placeholder="Descrição do produto..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FISCAL / ANVISA -->
                <div class="card mb-3">
                    <div class="card-header"><span style="font-weight:600;font-size:.9rem"><i class="fas fa-receipt me-2 text-success"></i>Fiscal / Regulatório</span></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">NCM <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" th:field="*{ncm}" placeholder="3305.90.00" maxlength="10">
                                <small class="text-muted">Código necessário para NF-e</small>
                            </div>
                            <div class="col-md-8">
                                <label class="form-label">Registro ANVISA</label>
                                <input type="text" class="form-control" th:field="*{registroAnvisa}" placeholder="Ex: 1234567890123">
                                <small class="text-muted">Deixe em branco se isento</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COLUNA LATERAL -->
            <div class="col-md-4">
                <!-- PREÇOS -->
                <div class="card mb-3">
                    <div class="card-header"><span style="font-weight:600;font-size:.9rem"><i class="fas fa-tag me-2 text-orange" style="color:#f59e0b"></i>Preços (R$)</span></div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Custo de Fabricação</label>
                            <div class="input-group">
                                <span class="input-group-text" style="font-size:.8rem">R$</span>
                                <input type="number" class="form-control" th:field="*{precoCusto}" step="0.01" min="0" placeholder="0,00">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Venda Varejo</label>
                            <div class="input-group">
                                <span class="input-group-text" style="font-size:.8rem">R$</span>
                                <input type="number" class="form-control" th:field="*{precoVendaVarejo}" step="0.01" min="0" placeholder="0,00">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Venda Atacado</label>
                            <div class="input-group">
                                <span class="input-group-text" style="font-size:.8rem">R$</span>
                                <input type="number" class="form-control" th:field="*{precoVendaAtacado}" step="0.01" min="0" placeholder="0,00">
                            </div>
                        </div>
                        <div class="mb-0">
                            <label class="form-label">Venda Distribuidor</label>
                            <div class="input-group">
                                <span class="input-group-text" style="font-size:.8rem">R$</span>
                                <input type="number" class="form-control" th:field="*{precoVendaDistribuidor}" step="0.01" min="0" placeholder="0,00">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESTOQUE -->
                <div class="card mb-3">
                    <div class="card-header"><span style="font-weight:600;font-size:.9rem"><i class="fas fa-boxes-stacked me-2 text-info" style="color:#06b6d4"></i>Estoque</span></div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Estoque Atual</label>
                            <input type="number" class="form-control" th:field="*{estoqueAtual}" min="0" placeholder="0">
                        </div>
                        <div class="mb-0">
                            <label class="form-label">Estoque Mínimo</label>
                            <input type="number" class="form-control" th:field="*{estoqueMinimo}" min="0" placeholder="0">
                            <small class="text-muted">Alerta será gerado abaixo deste valor</small>
                        </div>
                    </div>
                </div>

                <!-- STATUS -->
                <div class="card">
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" th:field="*{ativo}" id="ativoSwitch">
                            <label class="form-check-label fw-600" for="ativoSwitch" style="font-weight:600">Produto ativo</label>
                        </div>
                        <div class="mt-3 d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-floppy-disk me-2"></i>
                                <span th:text="${modoEdicao ? 'Salvar Alterações' : 'Cadastrar Produto'}">Salvar</span>
                            </button>
                            <a href="/web/estoque/produtos" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i> Voltar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</main>
<script>
    // Formatação automática de NCM ao digitar
    document.querySelector('[name="ncm"]')?.addEventListener('input', function() {
        let v = this.value.replace(/\D/g, '');
        if (v.length > 4) v = v.slice(0,4) + '.' + v.slice(4);
        if (v.length > 7) v = v.slice(0,7) + '.' + v.slice(7);
        this.value = v.slice(0, 10);
    });
</script>
</html>
